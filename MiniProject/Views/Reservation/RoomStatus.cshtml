@model Dictionary<Room, List<DateOnly>>

@{
    ViewBag.Title = "Room Availability";

    DateOnly min = ViewBag.Min;
    DateOnly max = ViewBag.Max;
}

<div class="page-container">

    <!-- Month Navigation -->
    <div class="month-nav">
        @for (int n = -1; n <= 1; n++)
        {
            var d = DateTime.Today.AddMonths(n);
            <a href="?month=@d.ToString("yyyy-MM")">@d.ToString("MMMM")</a>
        }
    </div>

    <!-- Legend -->
    <div class="legend">
        <span><div class="legend-box o"></div> Available</span>
        <span><div class="legend-box x"></div> Booked</span>
    </div>

    <!-- Availability Table -->
    <table class="availability-table">
        <caption>@min.ToString("MMMM yyyy")</caption>

        <tr>
            <th>Room</th>
            @for (var d = min; d < max; d = d.AddDays(1))
            {
                <th>@d.ToString("dd")</th>
            }
        </tr>

        @foreach (var (room, dates) in Model)
        {
            <tr>
                <td class="room-cell">
                    @room.Id<br />
                    <small>@room.RoomTypeId</small>
                </td>

                @for (var d = min; d < max; d = d.AddDays(1))
                {
                    var cls = dates.Contains(d) ? "x" : "o";
                    <td class="@cls"></td>
                }
            </tr>
        }
    </table>

    <!-- Booking CTA -->
    @foreach (var group in Model.GroupBy(m => m.Key.RoomTypeId))
    {
        <div class="cta">
            Interested in <strong>@group.Key</strong>?
            Book <a href="/Reservation/Reserve/@group.Key">now</a>!
        </div>
    }

</div>
