@using System.Text.Json
@model ReportPageVM

@{
    ViewBag.Title = "HomePage";
    Layout = "_Layout";
}
@if (User.IsInRole("Member"))
{
    <div style="display: flex; gap: 20px; align-items: flex-start;">
        <div>
            <p>Map Location :</p>
            <iframe src="https://www.google.com/maps?q=KualaLumpur,Malaysia&output=embed"
                    width="350"
                    height="175"
                    style="border:0;"
                    allowfullscreen
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
            </iframe>

        </div>


        @if (ViewBag.Review != null)
        {
            var r = ViewBag.Review;
            <div style="flex: 1; max-width: 400px;">
                <p>Review : (Click For More)</p>
                <a href="/Review/HotelReview?hotelId=@r.HotelId" style="text-decoration: none; color: inherit;">
                    <div class="review-box border rounded shadow-sm p-3 h-100">
                        <small class="text-muted">By @r.MemberEmail</small>
                        <hr />
                        <p>@r.Comment</p>
                        <div class="ratings">
                            <p><strong>Service:</strong> @r.ServiceRating / 5</p>
                            <p><strong>Cleanliness:</strong> @r.CleanlinessRating / 5</p>
                        </div>
                    </div>
                </a>
            </div>
        }
    </div>
    <div class="products">
        @foreach (var t in Model.RoomTypes)
        {
            var photo = t.RoomGalleries.Where(r => r.RoomTypeId == t.Id).Select(r => r.PhotoURL).FirstOrDefault();

            <div class="product">

                <div>@t.Name - RM @t.Price</div>
                <img style="cursor:pointer" data-get="Home/Detail?id=@t.Id" src="/room/@photo">
            </div>
        }
    </div>
}

@if (User.IsInRole("Admin"))
{
    <canvas id="myChart"></canvas>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Use the correct variables
        var labels = @Html.Raw(JsonSerializer.Serialize(
                    Model.SalesByRoomType.Select(s => s.RoomType)
            ));

    var values = @Html.Raw(JsonSerializer.Serialize(
                Model.SalesByRoomType.Select(s => s.TotalSales)
        ));

    // Only run if the canvas exists
    const ctx = document.getElementById("myChart");
    if (ctx && labels.length > 0) {
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Sales',
                    data: values
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }
</script>
}